
（①概要＝濃い要約／②詳細＝構造化まとめ／③発展・問い）

> この Markdown は、Cursor の **Agent** モードで呼び出されたときに、そのまま手順として実行する想定です。  
> 目的：`stock/06_Inbox/<最新日付>/` にある全 Markdown を **①概要→②詳細→③発展** の3部構成で要約し、**同じ日付名のサブフォルダ**で `stock/07_Articles/<最新日付>/` に**元ファイル名のまま**保存します。処理開始時に **入力件数をカウント** し、処理終了時に **完全性チェック** を行い、**全件要約が完了**しているか検証します。

---

## 前提

- ルート: `stock/`
    
- 入力: `stock/06_Inbox/<YYYY-MM-DD>/*.md`
    
- 出力: `stock/07_Articles/<YYYY-MM-DD>/*.md`
    
- **最新日付フォルダを維持**（移動・改名は行わない）
    
- 既存出力は **上書きしない**（必要に応じて `OVERWRITE=true` を指定）
    

---

## 出力テンプレート（保存フォーマット）

> ①は “これだけで全体が掴める” **濃い一段落の要約**（従来の詳細レベルを包含）。  
> ②は **小見出しつきでさらに噛み砕く** 構造化まとめ（文字数制限は緩め）。  
> ③は **疑問形の論点（3〜5件）** で、未来会議/YouTube台本に直結。

markdown

コピーする編集する

`--- title: <タイトル>                       # front matter > 見出し > ファイル名（拡張子除く） source_date: <YYYY-MM-DD>               # 入力フォルダ日付 source_path: ../06_Inbox/<YYYY-MM-DD>/<元記事ファイル名>.md summary_date: <YYYY-MM-DD>              # 要約実行日 importance: ★★★                         # 任意（★1〜★5） tags: [summary, auto] ---  # <タイトル>  ## ① 概要 （背景→主要ポイント→結論/示唆を**1段落**で。重要な固有名詞・数値を**1〜2点**必ず含める。**180〜260字**目安。従来の「詳細」に相当する情報密度。）  ## ② 詳細 **背景**：主要コンテキスト・前提。   **要点**：中核事実/主張（箇条書き可・**3〜7行**目安）。   **因果**：なぜそうなるか（根拠・仕組み・比較・反例）。   **結論/示唆**：意思決定・運用に直結する含意、注意点。  - 分量目安：**400〜1200字**（必要なら超過可）   - 表現：段落は**空行区切り**／箇条書き・番号付きリスト**可**／**短い表（〜5行×〜4列）可**   - 原則：新情報の追加や過度な仮説は避け、**本文要旨の整理・再構成**で可読性を最大化  ## ③ 発展（深掘りの論点・問い） - <疑問1：検証指標/期限/責任者の示唆を含める> - <疑問2> - <疑問3> (必要に応じて4〜5件まで)`

---

## 実行手順

### 【0】設定（任意）

- 出力の上書き許可：`OVERWRITE=true`
    
- 発展の問いの件数固定：`DEV_QUESTIONS=3`（未指定時は3〜5件）
    

---

### 【1】最新日付フォルダの特定


`latest_dir=$(ls -d stock/06_Inbox/*/ 2>/dev/null | grep -E '/[0-9]{4}-[0-9]{2}-[0-9]{2}/$' | sort -r | head -n 1) test -n "$latest_dir" || { echo "対象なし: stock/06_Inbox/ に日付フォルダがありません"; exit 0; } latest_date=$(basename "$latest_dir") echo "対象日付: $latest_date"`

---

### 【2】対象ファイルの取得 & 入力件数カウント


`files=$(ls -1 "${latest_dir}"*.md 2>/dev/null || true) if [ -z "$files" ]; then   echo "対象なし: ${latest_dir} に .md がありません"; exit 0; fi input_count=$(echo "$files" | wc -l | tr -d ' ') echo "入力件数: $input_count"`

---

### 【3】タイトル抽出ルール

- 優先順位：**front matter の `title:`** → **最初の `#` 見出し** → **拡張子を除いたファイル名**
    
- front matter は先頭の `---`〜`---` を YAML として解釈（無ければスキップ）
    

> 実装は各ファイルごとにこの優先順を適用すること。

---

### 【4】要約生成プロンプト（①濃い概要／②構造化詳細／③問い）

> front matter を除外した本文を入力に、以下のプロンプトで **1ファイルずつ** 生成する。


`あなたは日本語の要約編集者です。以下のMarkdown本文を、指定フォーマット（①概要／②詳細／③発展）で要約してください。  【出力要件】 - ①概要：背景→主要ポイント→結論/示唆を1段落で。重要な固有名詞・数値を1〜2点含め、180〜260字目安。 - ②詳細：小見出し（背景/要点/因果/結論）で再構成。400〜1200字目安（必要なら超過可）。箇条書き・番号付き・短表（〜5行×〜4列）を適宜用い、根拠と因果を明確化。 - ③発展：疑問形の箇条書き3〜5件。次の検証・意思決定に直結し、可能なら指標/期限/責任者の示唆を含める。 - 冗長・重複・枝葉は削除。推測は避け、必要時は「仮説」と明記。 - 出力はすべて日本語。  【出力フォーマット】 ## ① 概要 <本文>  ## ② 詳細 **背景**：<本文> **要点**：<本文 or 箇条書き(〜3〜7行)> **因果**：<本文> **結論/示唆**：<本文>  ## ③ 発展（深掘りの論点・問い） - <疑問1> - <疑問2> - <疑問3> (必要に応じて4〜5件)`

---

### 【5】保存

`out_dir="stock/07_Articles/${latest_date}/" mkdir -p "$out_dir"  # 擬似コード（実処理はエージェントが行う） # for f in $files; do #   1) front matter と本文を分離 #   2) タイトル抽出（front matter > 見出し > ファイル名） #   3) ステップ【4】のプロンプトで ①②③ を生成 #   4) 「出力テンプレート」を充填し "${out_dir}/$(basename "$f")" に保存 #      - 既存ファイルがあり、かつ OVERWRITE!=true の場合はスキップ # done`

- `source_path` は 07_Articles 側からの相対（例：`../06_Inbox/<日付>/<元名>.md`）
    
- `summary_date` は実行日
    
- ファイル名は **元ファイル名のまま**
    

---

### 【6】完全性チェック（取りこぼし検出／任意リトライ1回）



`# 入力ファイル名リスト printf "%s\n" $files | xargs -I{} basename {} > /tmp/_in_list.txt  # 出力ファイル名リスト ls -1 "${out_dir}"*.md 2>/dev/null | xargs -I{} basename {} > /tmp/_out_list.txt || true  # 欠損（入力にあって出力にない） missing=$(comm -23 <(sort /tmp/_in_list.txt) <(sort /tmp/_out_list.txt) || true)  input_count=$(wc -l < /tmp/_in_list.txt | tr -d ' ') output_count=$(wc -l < /tmp/_out_list.txt 2>/dev/null | tr -d ' ' || echo 0)  echo "出力件数: ${output_count}/${input_count}"  if [ -n "$missing" ]; then   echo "未生成ファイル（初回）:"   echo "$missing"   # 任意の簡易リトライ（1回） — ここで missing のみ再処理してもよい   # for name in $missing; do   #   ... リトライ処理 ...   # done    # リトライ後に再検証する場合   # ls -1 "${out_dir}"*.md 2>/dev/null | xargs -I{} basename {} > /tmp/_out_list.txt || true   # missing=$(comm -23 <(sort /tmp/_in_list.txt) <(sort /tmp/_out_list.txt) || true) fi`

---

### 【7】完了レポート（標準出力）

- 対象日付: `${latest_date}`
    
- 入力件数 / 出力件数
    
- 出力先: `stock/07_Articles/${latest_date}/`
    
- スキップ／エラー／未生成の一覧（あれば表示）
    
- 欠損が 0 の場合は **「全件完了」** と明記
    

---

## 運用メモ（コツ）

- ①は **動画冒頭でも読める一段落**、②は **台本の肉付け** に相当。
    
- ②の小見出しを太字固定にすることで、**人間の読みやすさ** と **後処理の機械抽出** を両立。
    
- ③は **指標/期限/責任者** を示唆した**疑問形**に落とすことで、会議・YouTube企画へ直結。
    
- 既存ファイルの上書き可否は開始時に統一（`OVERWRITE=true/false`）。
    

---

### 例：完了ログ（期待出力）

`対象日付: 2025-08-11 入力件数: 6 出力件数: 6/6 出力先: stock/07_Articles/2025-08-11/ 全件完了。欠損なし。`